{"version":3,"file":"slice.js","names":["Slice","props","process","env","GATSBY_SLICES","internalProps","sliceName","alias","__renderedByLocation","slicesContext","useContext","SlicesContext","propErrors","validateSliceProps","Object","keys","length","SlicePropsError","renderEnvironment","additionalContextMessage","sliceRoot","name","componentPath","Error","constructor","inBrowser","renderedByLocation","errors","entries","map","key","value","join","stack","message","fullStack","React","captureOwnerStack","ownerStack","currentStack","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactDebugCurrentFrame","getCurrentStack","stackLines","trim","split","slice","captureStackTrace","forcedLocation","functionName","seenObjects","path","undefined","propPath","indexOf","push"],"sources":["../slice.js"],"sourcesContent":["\"use client\"\n\nimport React, { useContext } from \"react\"\nimport { ServerSlice } from \"./slice/server-slice\"\nimport { InlineSlice } from \"./slice/inline-slice\"\nimport { SlicesContext } from \"./slice/context\"\n\nexport function Slice(props) {\n  if (process.env.GATSBY_SLICES) {\n    // we use sliceName internally, so remap alias to sliceName\n    const internalProps = {\n      ...props,\n      sliceName: props.alias,\n    }\n    delete internalProps.alias\n    delete internalProps.__renderedByLocation\n\n    const slicesContext = useContext(SlicesContext)\n\n    // validate props\n    const propErrors = validateSliceProps(props)\n    if (Object.keys(propErrors).length) {\n      throw new SlicePropsError(\n        slicesContext.renderEnvironment === `browser`,\n        internalProps.sliceName,\n        propErrors,\n        props.__renderedByLocation\n      )\n    }\n\n    if (slicesContext.renderEnvironment === `server`) {\n      return <ServerSlice {...internalProps} />\n    } else if (slicesContext.renderEnvironment === `browser`) {\n      // in the browser, we'll just render the component as is\n      return <InlineSlice {...internalProps} />\n    } else if (\n      slicesContext.renderEnvironment === `engines` ||\n      slicesContext.renderEnvironment === `dev-ssr`\n    ) {\n      // if we're in SSR, we'll just render the component as is\n      return <InlineSlice {...internalProps} />\n    } else if (slicesContext.renderEnvironment === `slices`) {\n      // we are not yet supporting nested slices\n\n      let additionalContextMessage = ``\n\n      // just in case generating additional contextual information fails, we still want the base message to show\n      // and not show another cryptic error message\n      try {\n        additionalContextMessage = `\\n\\nSlice component \"${slicesContext.sliceRoot.name}\" (${slicesContext.sliceRoot.componentPath}) tried to render <Slice alias=\"${props.alias}\"/>`\n      } catch {\n        // don't need to handle it, we will just skip the additional context message if we fail to generate it\n      }\n\n      throw new Error(\n        `Nested slices are not supported.${additionalContextMessage}\\n\\nSee https://gatsbyjs.com/docs/reference/built-in-components/gatsby-slice#nested-slices`\n      )\n    } else {\n      throw new Error(\n        `Slice context \"${slicesContext.renderEnvironment}\" is not supported.`\n      )\n    }\n  } else {\n    throw new Error(`Slices are disabled.`)\n  }\n}\n\nclass SlicePropsError extends Error {\n  constructor(inBrowser, sliceName, propErrors, renderedByLocation) {\n    const errors = Object.entries(propErrors)\n      .map(\n        ([key, value]) =>\n          `not serializable \"${value}\" type passed to \"${key}\" prop`\n      )\n      .join(`, `)\n\n    const name = `SlicePropsError`\n    let stack = ``\n    let message = ``\n\n    if (inBrowser) {\n      let fullStack = ``\n\n      // React 19+ uses captureOwnerStack, React 18 uses ReactDebugCurrentFrame.getCurrentStack\n      if (React.captureOwnerStack) {\n        // React 19+ approach\n        const ownerStack = React.captureOwnerStack()\n        const currentStack = new Error().stack || ``\n        fullStack = ownerStack ? `${currentStack}\\n${ownerStack}` : currentStack\n      } else if (\n        React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED\n          ?.ReactDebugCurrentFrame?.getCurrentStack\n      ) {\n        // React 18 approach\n        fullStack =\n          React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactDebugCurrentFrame.getCurrentStack()\n      } else {\n        // Fallback if neither API is available\n        fullStack = new Error().stack || ``\n      }\n\n      // remove the first line of the stack trace\n      const stackLines = fullStack.trim().split(`\\n`).slice(1)\n      if (stackLines.length > 0) {\n        stackLines[0] = stackLines[0].trim()\n        stack = `\\n` + stackLines.join(`\\n`)\n      }\n\n      message = `Slice \"${sliceName}\" was passed props that are not serializable (${errors}).`\n    } else {\n      // we can't really grab any extra info outside of the browser, so just print what we can\n      message = `${name}: Slice \"${sliceName}\" was passed props that are not serializable (${errors}).`\n      const stackLines = new Error().stack.trim().split(`\\n`).slice(2)\n      stack = `${message}\\n${stackLines.join(`\\n`)}`\n    }\n\n    super(message)\n    this.name = name\n    if (stack) {\n      this.stack = stack\n    } else {\n      Error.captureStackTrace(this, SlicePropsError)\n    }\n\n    if (renderedByLocation) {\n      this.forcedLocation = { ...renderedByLocation, functionName: `Slice` }\n    }\n  }\n}\n\nconst validateSliceProps = (\n  props,\n  errors = {},\n  seenObjects = [],\n  path = null\n) => {\n  // recursively validate all props\n  for (const [name, value] of Object.entries(props)) {\n    if (\n      value === undefined ||\n      value === null ||\n      (!path && name === `children`)\n    ) {\n      continue\n    }\n\n    const propPath = path ? `${path}.${name}` : name\n\n    if (typeof value === `function`) {\n      errors[propPath] = typeof value\n    } else if (typeof value === `object` && seenObjects.indexOf(value) <= 0) {\n      seenObjects.push(value)\n      validateSliceProps(value, errors, seenObjects, propPath)\n    }\n  }\n\n  return errors\n}\n"],"mappings":"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"}